<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: services/ApiClient.jsx</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: services/ApiClient.jsx</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * @fileoverview API Client Service
 * 
 * Centralized HTTP client built on Axios for all API communications.
 * Implements singleton pattern, request/response interceptors, automatic
 * token injection, error handling, and authentication state management.
 * 
 * Features:
 * - Singleton instance (single HTTP client across app)
 * - Automatic JWT token injection in request headers
 * - Request/response logging for debugging
 * - Global error handling with 401 redirect
 * - CORS credentials support for cookies
 * - Configurable timeout and base URL
 * - Request/response interceptors
 * - Centralized API configuration
 * 
 * Architecture Pattern: Singleton + Interceptor Pattern
 * - Single client instance shared across application
 * - Interceptors for cross-cutting concerns
 * - Separation from business logic
 * - Reusable HTTP methods
 * 
 * Security Features:
 * - Automatic token injection (Authorization header)
 * - Token validation on 401 responses
 * - Automatic logout on authentication failure
 * - HTTPS-only in production
 * - CORS credentials for secure cookies
 * 
 * Error Handling:
 * - Global 401 handling (token expired/invalid)
 * - Automatic redirect to login
 * - Token cleanup on authentication failure
 * - Error logging for debugging
 * - Promise rejection for component handling
 * 
 * Performance Considerations:
 * - Single Axios instance (connection pooling)
 * - 10-second timeout to prevent hanging requests
 * - Efficient header management
 * - Minimal overhead in interceptors
 * 
 * @module services/ApiClient
 * @requires axios
 * @requires ../utils/TokenManager
 * 
 * @author mr.shaan
 * @version 1.0.0
 * @since 2025-12-16
 * 
 * @example
 * // Basic GET request
 * import ApiClient from './services/ApiClient';
 * 
 * const response = await ApiClient.get('/users');
 * console.log(response.data);
 * 
 * @example
 * // POST with data
 * const response = await ApiClient.post('/auth/login', {
 *   email: 'user@example.com',
 *   password: 'password123'
 * });
 * 
 * @example
 * // With custom config
 * const response = await ApiClient.get('/large-file', {
 *   timeout: 30000,
 *   responseType: 'blob'
 * });
 */

import axios from 'axios';
import TokenManager from '../utils/TokenManager';


/**
 * ApiClient Class
 * 
 * HTTP client wrapper around Axios with built-in authentication,
 * error handling, and request/response interceptors. Implements
 * singleton pattern - only one instance exists throughout the app.
 * 
 * Design Decisions:
 * - Singleton: Ensures consistent configuration
 * - Interceptors: DRY principle for cross-cutting concerns
 * - Axios: Battle-tested HTTP library with wide support
 * - TokenManager: Separation of token storage logic
 * 
 * Configuration Priority:
 * 1. Constructor baseURL parameter
 * 2. VITE_API_URL environment variable
 * 3. Fallback: http://localhost:3000/api
 * 
 * Request Flow:
 * 1. Component calls ApiClient.get/post/put/delete
 * 2. Request interceptor adds Authorization header
 * 3. Request sent to backend API
 * 4. Response interceptor logs response
 * 5. Data returned to component
 * 
 * Error Flow:
 * 1. API returns error response
 * 2. Response interceptor catches error
 * 3. If 401: Clear auth data, redirect to login
 * 4. Other errors: Log and reject promise
 * 5. Component handles error in catch block
 * 
 * @class ApiClient
 * @example
 * // Internal instantiation (singleton)
 * const apiClient = new ApiClient();
 * export default apiClient;
 */
class ApiClient {
  /**
   * Creates ApiClient instance with configured Axios client
   * 
   * Initializes Axios instance with base configuration and sets up
   * request/response interceptors for authentication and error handling.
   * 
   * Configuration Options:
   * - baseURL: API endpoint base URL
   * - timeout: Maximum request duration (10 seconds)
   * - headers: Default headers (Content-Type: application/json)
   * - withCredentials: Enable CORS cookies/auth
   * 
   * Interceptors Setup:
   * - Request: Add Authorization header, log requests
   * - Response: Log responses, handle 401 errors
   * 
   * @constructor
   * @param {string} [baseURL] - Optional custom API base URL
   * 
   * @example
   * // Default initialization (uses env var or localhost)
   * const client = new ApiClient();
   * 
   * @example
   * // Custom base URL
   * const client = new ApiClient('https://api.myapp.com');
   */
  constructor(baseURL) {
    /**
     * Configured Axios instance
     * @type {import('axios').AxiosInstance}
     * @private
     */
    this.client = axios.create({
      // Base URL priority: param > env var > localhost fallback
      baseURL: baseURL || import.meta.env.VITE_API_URL || 'http://localhost:3000/api',
      
      // Request timeout (10 seconds)
      timeout: 10000,
      
      // Default headers for all requests
      headers: {
        'Content-Type': 'application/json',
      },
      
      // Enable cookies and authentication headers for CORS
      withCredentials: true,
    });


    /**
     * Request Interceptor
     * 
     * Intercepts all outgoing requests to inject authentication token
     * and log request details for debugging.
     * 
     * Operations:
     * 1. Retrieve JWT token from TokenManager
     * 2. If token exists, add to Authorization header
     * 3. Log request method and URL
     * 4. Return modified config
     * 
     * Token Format: "Bearer &lt;jwt-token>"
     * 
     * Header Example:
     * Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
     * 
     * @memberof ApiClient
     * @private
     */
    this.client.interceptors.request.use(
      /**
       * Request success handler
       * @param {import('axios').AxiosRequestConfig} config - Request configuration
       * @returns {import('axios').AxiosRequestConfig} Modified configuration
       */
      (config) => {
        // Retrieve stored JWT token
        const token = TokenManager.getToken();
        
        // Inject token into Authorization header if available
        if (token) {
          config.headers.Authorization = `Bearer ${token}`;
        }
        
        // Log request for debugging (remove in production)
        console.log('API Request:', config.method.toUpperCase(), config.url);
        
        return config;
      },
      
      /**
       * Request error handler
       * @param {Error} error - Request setup error
       * @returns {Promise&lt;never>} Rejected promise
       */
      (error) => {
        console.error('Request error:', error);
        return Promise.reject(error);
      }
    );


    /**
     * Response Interceptor
     * 
     * Intercepts all responses to log successful requests and handle
     * authentication errors (401) globally.
     * 
     * Success Operations:
     * 1. Log response status and URL
     * 2. Return response to caller
     * 
     * Error Operations:
     * 1. Log error status and message
     * 2. Check if 401 Unauthorized
     * 3. If 401: Clear auth data, redirect to login
     * 4. Reject promise for component handling
     * 
     * 401 Handling Rationale:
     * - Token expired: User session ended
     * - Token invalid: Possible tampering
     * - Token missing: Authentication required
     * - Solution: Clear local state, force re-login
     * 
     * @memberof ApiClient
     * @private
     */
    this.client.interceptors.response.use(
      /**
       * Response success handler
       * @param {import('axios').AxiosResponse} response - Successful response
       * @returns {import('axios').AxiosResponse} Response object
       */
      (response) => {
        // Log successful response for debugging
        console.log('API Response:', response.status, response.config.url);
        return response;
      },
      
      /**
       * Response error handler
       * 
       * Handles HTTP errors, with special treatment for 401 Unauthorized.
       * Automatically logs user out and redirects to login on authentication failure.
       * 
       * @param {import('axios').AxiosError} error - Response error object
       * @returns {Promise&lt;never>} Rejected promise with error
       */
      (error) => {
        // Log error details for debugging
        console.error('API Error:', error.response?.status, error.message);
        
        // Handle 401 Unauthorized (token expired/invalid)
        if (error.response?.status === 401) {
          // Clear authentication data (token, user data)
          TokenManager.clearAuthData();
          
          // Redirect to login page
          // Note: Hard redirect, not React Router navigation
          // Ensures complete state reset
          window.location.href = '/login';
        }
        
        // Reject promise for component-level error handling
        return Promise.reject(error);
      }
    );
  }


  /**
   * Performs GET request
   * 
   * Retrieves data from the specified endpoint. Automatically includes
   * authentication token via request interceptor.
   * 
   * Use Cases:
   * - Fetch user data
   * - Get list of resources
   * - Retrieve single resource by ID
   * - Search/filter operations
   * 
   * @async
   * @method get
   * @param {string} url - Endpoint URL (relative to baseURL)
   * @param {import('axios').AxiosRequestConfig} [config={}] - Optional Axios config
   * @returns {Promise&lt;import('axios').AxiosResponse>} Response with data
   * 
   * @throws {Error} Network errors, server errors, or validation errors
   * 
   * @example
   * // Get user profile
   * const response = await ApiClient.get('/auth/profile');
   * console.log(response.data.user);
   * 
   * @example
   * // Get with query parameters
   * const response = await ApiClient.get('/users', {
   *   params: { page: 1, limit: 10 }
   * });
   * 
   * @example
   * // Get with custom timeout
   * const response = await ApiClient.get('/large-data', {
   *   timeout: 30000
   * });
   */
  async get(url, config = {}) {
    return this.client.get(url, config);
  }


  /**
   * Performs POST request
   * 
   * Sends data to create a new resource or perform an action.
   * Automatically includes authentication token and sets Content-Type.
   * 
   * Use Cases:
   * - User registration
   * - User login
   * - Create new resource
   * - Submit form data
   * 
   * @async
   * @method post
   * @param {string} url - Endpoint URL (relative to baseURL)
   * @param {Object} [data={}] - Request body data
   * @param {import('axios').AxiosRequestConfig} [config={}] - Optional Axios config
   * @returns {Promise&lt;import('axios').AxiosResponse>} Response with created data
   * 
   * @throws {Error} Validation errors, server errors, or network errors
   * 
   * @example
   * // Login user
   * const response = await ApiClient.post('/auth/login', {
   *   email: 'user@example.com',
   *   password: 'password123'
   * });
   * 
   * @example
   * // Create resource
   * const response = await ApiClient.post('/users', {
   *   name: 'John Doe',
   *   email: 'john@example.com'
   * });
   * 
   * @example
   * // Upload file with FormData
   * const formData = new FormData();
   * formData.append('file', file);
   * const response = await ApiClient.post('/upload', formData, {
   *   headers: { 'Content-Type': 'multipart/form-data' }
   * });
   */
  async post(url, data = {}, config = {}) {
    return this.client.post(url, data, config);
  }


  /**
   * Performs PUT request
   * 
   * Updates an existing resource with new data. Typically replaces
   * the entire resource (use PATCH for partial updates).
   * 
   * Use Cases:
   * - Update user profile
   * - Change password
   * - Update resource completely
   * - Replace configuration
   * 
   * @async
   * @method put
   * @param {string} url - Endpoint URL (relative to baseURL)
   * @param {Object} [data={}] - Updated resource data
   * @param {import('axios').AxiosRequestConfig} [config={}] - Optional Axios config
   * @returns {Promise&lt;import('axios').AxiosResponse>} Response with updated data
   * 
   * @throws {Error} Validation errors, not found errors, or server errors
   * 
   * @example
   * // Update user profile
   * const response = await ApiClient.put('/auth/profile', {
   *   name: 'Jane Doe',
   *   email: 'jane@example.com'
   * });
   * 
   * @example
   * // Change password
   * const response = await ApiClient.put('/auth/password', {
   *   currentPassword: 'oldpass',
   *   newPassword: 'newpass123'
   * });
   */
  async put(url, data = {}, config = {}) {
    return this.client.put(url, data, config);
  }


  /**
   * Performs DELETE request
   * 
   * Deletes a resource from the server. Requires authentication
   * for protected resources.
   * 
   * Use Cases:
   * - Delete user account
   * - Remove resource
   * - Logout (delete session)
   * - Cancel operation
   * 
   * @async
   * @method delete
   * @param {string} url - Endpoint URL (relative to baseURL)
   * @param {import('axios').AxiosRequestConfig} [config={}] - Optional Axios config
   * @returns {Promise&lt;import('axios').AxiosResponse>} Response confirming deletion
   * 
   * @throws {Error} Not found errors, permission errors, or server errors
   * 
   * @example
   * // Logout user
   * const response = await ApiClient.delete('/auth/logout');
   * 
   * @example
   * // Delete resource by ID
   * const response = await ApiClient.delete(`/users/${userId}`);
   * 
   * @example
   * // Delete with confirmation
   * const response = await ApiClient.delete('/users/me', {
   *   data: { confirmPassword: 'password123' }
   * });
   */
  async delete(url, config = {}) {
    return this.client.delete(url, config);
  }
}


/**
 * Singleton ApiClient Instance
 * 
 * Single shared instance exported for use throughout the application.
 * Ensures consistent configuration and connection pooling.
 * 
 * Import this instance in your services and components:
 * 
 * @example
 * import ApiClient from './services/ApiClient';
 * 
 * @type {ApiClient}
 * @constant
 * @default
 */
export default new ApiClient();
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-components_auth_LoginForm.html">components/auth/LoginForm</a></li><li><a href="module-components_auth_SignupForm.html">components/auth/SignupForm</a></li><li><a href="module-components_common_Input.html">components/common/Input</a></li><li><a href="module-components_common_ProtectedRoute.html">components/common/ProtectedRoute</a></li><li><a href="module-components_layout_Header.html">components/layout/Header</a></li><li><a href="module-context_AuthContext.html">context/AuthContext</a></li><li><a href="module-services_ApiClient.html">services/ApiClient</a></li><li><a href="module-services_AuthService.html">services/AuthService</a></li><li><a href="module-utils_TokenManager.html">utils/TokenManager</a></li></ul><h3>Classes</h3><ul><li><a href="module-services_ApiClient-ApiClient.html">ApiClient</a></li><li><a href="module-services_AuthService-AuthService.html">AuthService</a></li><li><a href="module-utils_TokenManager-TokenManager.html">TokenManager</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.5</a> on Tue Dec 16 2025 02:17:08 GMT+0530 (India Standard Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
